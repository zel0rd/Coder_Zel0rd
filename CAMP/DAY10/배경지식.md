# 배경지식

## 운영체제 
주요 운영체제와 다음과 관련된 내용들을 학습하는 게 중요
- 프로세스를 관리하는 자료구조에 대해 학습
- 프로세스와 스레드의 관계에 대해 학습
- 운영체제에서 사용하는 작업 스케쥴리 알고리즘에 대해 학습


## 프로세스
- Process is program in execution
프로세스(Process)는 CPU가 처리하는 작업(Task)라고도 불리며, 실행중인 프로그램을 의미  
좀 더 구체적으로 디스크에 저장되어 있던 실행 가능한 프로그램이 메모리에 적재되어 운영체제가 관리하는 상태를 의미한다.

### 프로세스 문맥(context)
- 프로세스의 문맥(context)는 프로세스가 현재 어떤 상태에서 수행되고 있는지를 정확히 규명하기 위해 필요한 정보를 의미한다.  
- 시분할 시스템(time sharing system)에서는 타이머 인터럽트에 의해 짧은 시간동안 cpu를 사용한 후 cpu를 선점당했다가 다시 획득하는 식으로 cpu 관리가 이루어 진다. 따라서, 명령의 수행을 재개하는 시점이 되면 cpu 선점당하기 전 시점에 어느 부분까지 명령을 수행했는지에 대한 상태정보를 재현할 필요가 있다.  
- 정확한 재현을 위해 필요한 정보가 문맥(context)이다.  
- 프로세스의 주소공간(코드,데이터,스택)을 비로새 레지스터에 어떤 값을 가지고 있었는지, 시스템 콜 등을 통해 커널에서 수행한 일의 상태, 커널이 관리하고 있는 pcb 정보등을 포함한다.
  
### 프로세서 상태
- Running : CPU를 잡고 instruction을 수행중인 상태
- Ready : CPU를 기다리는 상태, queue에서 대기하고 있음, 물리적인 메모리에 코드가 올라옴
- Blocked(wait, sleep) : 디스크에서 file을 읽어와야 하는 오래 걸리는 작업을 하거나, 다른 프로세스의 진행을 위해 일부러 재워둔 상태  
- New : 프로세스가 생성중인 상태
- Terminated :  프로그램의 execution이 끝나고 종료중인 상태

### PCB(Process Control Block)
운영체제가 관리상 사용하는 정보
- process state(현재 process의 상태)

- process ID(Process마다 갖는 고유의 값)

- scheduling information(우선순위 같은 스케줄링에 대한 정보)

CPU 수행에 관련된 Program Counter 값, 각종 register값, code, data, stack 에 대한 정보

<img src='https://t1.daumcdn.net/cfile/tistory/261C1850574AB89D13' />

### Context Switch(문맥 교환)

문맥 교환이란 CPU를 어떤 프로세스에서 다른 프로세스로 넘겨주는 과정을 말한다.  

System call이나 Interrupt가 발생했더고 해서 반드시 Context Switch가 발생하는 것은 아니다.  

프로세스 내부에서 System Call을 요청하거나 Interrupt가 외부에서 들어왔어도,  

운영체제에서의 일을 마치고 다시 할당되었던 CPU로 넘어가게 된다.  

다른 프로세스로 넘어가는 과정은 상당한 오버헤드를 발생시킨다.  

cache memory에 있던 진행하던 프로세스에 대한 cache를 모두 비워줘야하기 때문이다.  

그래서 문맥교환이 일어나는 상황은 크게 두가지 경우이다.  

Interrupt 중에서도 timer Interrupt가 들어왔을 때와 I/O 요청 system call요청이 들어왔을 때이다.  



### 프로세스를 스케줄링하기 위한 Queue

Job Queue : 현재 시스템 내에 있는 모든 프로세스의 집합을 의미한다.  

Ready Queue : 현재 메모리 내에 있으면서 CPU를 잡아서 실행되기를 기다리는 프로세스의 집합을 의미한다.  

Device Queue :  Device I/O작업을 대기하고 있는 프로세스의 집합을 의미한다.  

이 Queue들은 연결리스트를 기반으로 하는 Queue의 자료구조를 하고 있다.  



## 메모리 역할
- 메모리는 실행할 프로그램을 저장하고 있고, 읽고 쓰는 데이터를 쓰기도 한다.

## 프로세스 메모리 구조
> 프로세스가 메모리에 locate될 때 구조는 다음과 같다.  
> 각 영역별로 어떤 의미가 있고 어떻게 구분되는지 확인  
<img src='https://github.com/zel0rd/day1-challenge/blob/master/day10/image1.png?raw=true' />

> Stack변수와 Heap 객체가 만들어지는 흐름을 학습  
> 객체를 만드는 방식에 따라서 처리 방식이 어떻게 다른지 학습  
<img src='https://raw.githubusercontent.com/zel0rd/day1-challenge/master/day10/image2.png?token=AG3XE3N4465BKYILUXFDW727HNVPM' />


### 스택
함수나 프로시저를 호출하고 리턴할 때 복귀 주소나 지역 변수와 같은 일시적인 데이터를 저장하는 메모리 영역이다.

### 힙
프로그램 실행 중에 동적으로 메모리를 할당할 수 있는 자유로운 영역이다.

### 데이터 (BSS, GVAR)
초기화한 데이터 구조에 따라서 읽고 쓰기가 가능한 영역이다.

### 텍스트
프로세서가 실행할 바이너리 코드를 저장해 놓은 영역이다.

## 프로세스 스케줄링

### 프로세스 상태
생성 -> 준비 -> 실행 <-> 대기 -> 종료까지 크게 5가지 상태가 있다.

프로세스를 생성해서 계속해서 실행하지 않고, 다른 프로세스를 실행하는 동안 대기했다가 다시 실행하는 순서를 반복하게 된다.

<img src='https://raw.githubusercontent.com/zel0rd/day1-challenge/master/day10/image3.jpg?token=AG3XE3N5N5LLTKUCEJX5LQC7HNWAK' />

이미지 출처 프로세스 관리 참조 https://wiki.kldp.org/wiki.php/ProcessManagement

## 스레드

경량 프로세스 Light Weight Process라고 프로세스에서 실행 제어만 분리해서 처리하는 단위를 만들었다.  
스레드는 같은 그룹의 스레드와 코드, 메모리 주소 공간, 운영체제 리소스를 공유한다. 프로세스는 하나 이상의 스레드를 가지고 각 스레드는 다음 같은 동작을 담당한다.

- 스레드 실행에 대한 상태 관리
- 실행을 위한 별도 스택
- 지역 변수와 스레드 특정 데이터를 저장하는 데이터 저장소
- 프로세스의 메모리와 자원에 대한 접근을 기록하는 컨텍스트 정보

<img src='https://raw.githubusercontent.com/zel0rd/day1-challenge/master/day10/image4.png?token=AG3XE3JEKI5WBMBKHBDAZPS7HNWAO' />

### 특징  
- 스레드를 사용하면 사용자에 대한 응답성을 증가시킬 수 있다.
- 프로세스 자원과 메모리를 공유할 수 있다.
- 자원을 공유하기 때문에 경제적이다.
- 다중 프로세서와 다중 스레드를 혼합해서 병렬 실행이 가능하다.
- 현대 CPU들은 다중 스레드를 처리하는 하드웨어 로직을 가지고 있다.


### 학습거리  

- 프로세스나 스레드가 만들어지고 종료될 때까지 스케줄러에 따라서 어떤 상태로 변화하는지 학습한다.
- 노드 환경에서는 웹 워커(Web Worker)나 워커 스레드(Worker Thread)을 학습한다.

## 프로세스와 스레드의 차이(Process vs Thread)

### Program이란
어떤 작업을 위해 실행할 수 있는 파일

### 프로세스(Process)란

참고 : 할당받는 시스템 자원의 예
- CPU 시간
- 운영되기 위해 필요한 주소 공간
- Code, Data, Stack, Heap의 구조로 되어 있는 독립된 메모리 영역

### 스레드(Thread)란

사전적 의미
- “프로세스 내에서 실행되는 여러 흐름의 단위”
- 프로세스의 특정한 수행 경로
- 프로세스가 할당받은 자원을 이용하는 실행의 단위  

특징
- 스레드는 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유한다.
- 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름으로, 프로세스 내의 주소 공간이나 자원들(힙 공간 등)을 같은 프로세스 내에 스레드끼리 공유하면서 실행된다.
- 같은 프로세스 안에 있는 여러 스레드들은 같은 힙 공간을 공유한다. 반면에 프로세스는 다른 프로세스의 메모리에 직접 접근할 수 없다.
- 각각의 스레드는 별도의 레지스터와 스택을 갖고 있지만, 힙 메모리는 서로 읽고 쓸 수 있다.
- 한 스레드가 프로세스 자원을 변경하면, 다른 이웃 스레드(sibling thread)도 그 변경 결과를 즉시 볼 수 있다.

-------
# process 객체 구조
- name, maxTimeSecond, status(ready, running, waiting, terminated)

# 0. main
- 랜덤의 maxTimeSecond를 갖는 (10초미만) 프로세스 3개를 생성
